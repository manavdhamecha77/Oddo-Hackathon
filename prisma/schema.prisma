generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model customer_invoice_lines {
  id                Int               @id @default(autoincrement())
  invoice_id        Int
  product_id        Int?
  description       String
  quantity          Decimal           @default(1) @db.Decimal(10, 2)
  unit_price        Decimal           @db.Decimal(10, 2)
  customer_invoices customer_invoices @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  products          products?         @relation(fields: [product_id], references: [id], onDelete: Restrict)
}

model customer_invoices {
  id                     Int                      @id @default(autoincrement())
  invoice_number         String                   @unique @db.VarChar(100)
  project_id             Int?
  sales_order_id         Int?
  customer_id            Int
  invoice_date           DateTime                 @default(now()) @db.Date
  due_date               DateTime?                @db.Date
  status                 customer_invoice_status  @default(draft)
  total_amount           Decimal                  @default(0.00) @db.Decimal(12, 2)
  paid_amount            Decimal                  @default(0.00) @db.Decimal(12, 2)
  notes                  String?
  created_by             Int?
  created_at             DateTime                 @default(now())
  updated_at             DateTime
  customer_invoice_lines customer_invoice_lines[]
  users                  users?                   @relation(fields: [created_by], references: [id])
  partners               partners                 @relation(fields: [customer_id], references: [id])
  projects               projects?                @relation(fields: [project_id], references: [id])
  sales_orders           sales_orders?            @relation(fields: [sales_order_id], references: [id])

  @@index([project_id])
}

model expenses {
  id                                Int            @id @default(autoincrement())
  expense_number                    String         @unique @db.VarChar(100)
  project_id                        Int?
  user_id                           Int
  category                          String         @db.VarChar(100)
  description                       String
  amount                            Decimal        @db.Decimal(10, 2)
  expense_date                      DateTime       @default(now()) @db.Date
  is_billable                       Boolean        @default(false)
  status                            expense_status @default(submitted)
  receipt_path                      String?        @db.VarChar(500)
  approved_by                       Int?
  approved_at                       DateTime?
  notes                             String?
  created_at                        DateTime       @default(now())
  updated_at                        DateTime
  users_expenses_approved_byTousers users?         @relation("expenses_approved_byTousers", fields: [approved_by], references: [id])
  projects                          projects?      @relation(fields: [project_id], references: [id])
  users_expenses_user_idTousers     users          @relation("expenses_user_idTousers", fields: [user_id], references: [id])

  @@index([project_id])
  @@index([user_id])
}

model partners {
  id                Int                 @id @default(autoincrement())
  name              String              @db.VarChar(255)
  type              partner_type
  email             String?             @db.VarChar(255)
  phone             String?             @db.VarChar(50)
  address           String?
  created_at        DateTime            @default(now())
  updated_at        DateTime
  customer_invoices customer_invoices[]
  projects          projects[]
  purchase_orders   purchase_orders[]
  sales_orders      sales_orders[]
  vendor_bills      vendor_bills[]
}

model products {
  id                     Int                      @id @default(autoincrement())
  name                   String                   @db.VarChar(255)
  description            String?
  unit_price             Decimal                  @db.Decimal(10, 2)
  cost_price             Decimal?                 @db.Decimal(10, 2)
  is_service             Boolean                  @default(false)
  created_at             DateTime                 @default(now())
  updated_at             DateTime
  customer_invoice_lines customer_invoice_lines[]
  purchase_order_lines   purchase_order_lines[]
  sales_order_lines      sales_order_lines[]
  vendor_bill_lines      vendor_bill_lines[]
}

model project_members {
  id          Int      @id @default(autoincrement())
  project_id  Int
  user_id     Int
  role        String?  @db.VarChar(100)
  assigned_at DateTime @default(now())
  projects    projects @relation(fields: [project_id], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([project_id, user_id])
}

model projects {
  id                 Int                 @id @default(autoincrement())
  name               String              @db.VarChar(255)
  description        String?
  project_manager_id Int?
  customer_id        Int?
  status             project_status      @default(planned)
  start_date         DateTime?           @db.Date
  end_date           DateTime?           @db.Date
  deadline           DateTime?           @db.Date
  budget             Decimal             @default(0.00) @db.Decimal(12, 2)
  progress           Decimal             @default(0.00) @db.Decimal(5, 2)
  created_at         DateTime            @default(now())
  updated_at         DateTime
  customer_invoices  customer_invoices[]
  expenses           expenses[]
  project_members    project_members[]
  partners           partners?           @relation(fields: [customer_id], references: [id])
  users              users?              @relation(fields: [project_manager_id], references: [id])
  purchase_orders    purchase_orders[]
  sales_orders       sales_orders[]
  tasks              tasks[]
  timesheets         timesheets[]
  vendor_bills       vendor_bills[]

  @@index([project_manager_id])
  @@index([status])
}

model purchase_order_lines {
  id                Int             @id @default(autoincrement())
  purchase_order_id Int
  product_id        Int?
  description       String
  quantity          Decimal         @default(1) @db.Decimal(10, 2)
  unit_price        Decimal         @db.Decimal(10, 2)
  products          products?       @relation(fields: [product_id], references: [id], onDelete: Restrict)
  purchase_orders   purchase_orders @relation(fields: [purchase_order_id], references: [id], onDelete: Cascade)
}

model purchase_orders {
  id                   Int                    @id @default(autoincrement())
  order_number         String                 @unique @db.VarChar(100)
  project_id           Int?
  vendor_id            Int
  order_date           DateTime               @default(now()) @db.Date
  status               purchase_order_status  @default(draft)
  total_amount         Decimal                @default(0.00) @db.Decimal(12, 2)
  notes                String?
  created_by           Int?
  created_at           DateTime               @default(now())
  updated_at           DateTime
  purchase_order_lines purchase_order_lines[]
  users                users?                 @relation(fields: [created_by], references: [id])
  projects             projects?              @relation(fields: [project_id], references: [id])
  partners             partners               @relation(fields: [vendor_id], references: [id])
  vendor_bills         vendor_bills[]

  @@index([project_id])
}

model roles {
  id          Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(50)
  description String? @db.VarChar(255)
  users       users[]
}

model sales_order_lines {
  id             Int          @id @default(autoincrement())
  sales_order_id Int
  product_id     Int?
  description    String
  quantity       Decimal      @default(1) @db.Decimal(10, 2)
  unit_price     Decimal      @db.Decimal(10, 2)
  products       products?    @relation(fields: [product_id], references: [id], onDelete: Restrict)
  sales_orders   sales_orders @relation(fields: [sales_order_id], references: [id], onDelete: Cascade)
}

model sales_orders {
  id                Int                 @id @default(autoincrement())
  order_number      String              @unique @db.VarChar(100)
  project_id        Int?
  customer_id       Int
  order_date        DateTime            @default(now()) @db.Date
  status            sales_order_status  @default(draft)
  total_amount      Decimal             @default(0.00) @db.Decimal(12, 2)
  notes             String?
  created_by        Int?
  created_at        DateTime            @default(now())
  updated_at        DateTime
  customer_invoices customer_invoices[]
  sales_order_lines sales_order_lines[]
  users             users?              @relation(fields: [created_by], references: [id])
  partners          partners            @relation(fields: [customer_id], references: [id])
  projects          projects?           @relation(fields: [project_id], references: [id])

  @@index([project_id])
}

model task_attachments {
  id          Int      @id @default(autoincrement())
  task_id     Int
  file_name   String   @db.VarChar(255)
  file_path   String   @db.VarChar(500)
  file_size   Int?
  uploaded_by Int?
  uploaded_at DateTime @default(now())
  tasks       tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users       users?   @relation(fields: [uploaded_by], references: [id])
}

model task_comments {
  id         Int      @id @default(autoincrement())
  task_id    Int
  user_id    Int
  comment    String
  created_at DateTime @default(now())
  tasks      tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model tasks {
  id                             Int                @id @default(autoincrement())
  project_id                     Int
  title                          String             @db.VarChar(255)
  description                    String?
  assigned_to                    Int?
  status                         task_status        @default(new)
  priority                       task_priority      @default(medium)
  due_date                       DateTime?          @db.Date
  estimated_hours                Decimal?           @db.Decimal(8, 2)
  actual_hours                   Decimal            @default(0.00) @db.Decimal(8, 2)
  blocker_reason                 String?
  created_by                     Int?
  created_at                     DateTime           @default(now())
  updated_at                     DateTime
  task_attachments               task_attachments[]
  task_comments                  task_comments[]
  users_tasks_assigned_toTousers users?             @relation("tasks_assigned_toTousers", fields: [assigned_to], references: [id])
  users_tasks_created_byTousers  users?             @relation("tasks_created_byTousers", fields: [created_by], references: [id])
  projects                       projects           @relation(fields: [project_id], references: [id], onDelete: Cascade)
  timesheets                     timesheets[]

  @@index([assigned_to])
  @@index([project_id])
  @@index([status])
}

model timesheets {
  id          Int      @id @default(autoincrement())
  task_id     Int
  user_id     Int
  project_id  Int
  work_date   DateTime @db.Date
  hours       Decimal  @db.Decimal(8, 2)
  is_billable Boolean  @default(true)
  hourly_rate Decimal  @db.Decimal(10, 2)
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime
  projects    projects @relation(fields: [project_id], references: [id], onDelete: Cascade)
  tasks       tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([project_id])
  @@index([user_id])
  @@index([work_date])
}

model users {
  id                                   Int                 @id @default(autoincrement())
  email                                String              @unique
  password_hash                        String
  first_name                           String?             @db.VarChar(100)
  last_name                            String?             @db.VarChar(100)
  role_id                              Int
  hourly_rate                          Decimal             @default(0.00) @db.Decimal(10, 2)
  is_active                            Boolean             @default(true)
  created_at                           DateTime            @default(now())
  updated_at                           DateTime
  customer_invoices                    customer_invoices[]
  expenses_expenses_approved_byTousers expenses[]          @relation("expenses_approved_byTousers")
  expenses_expenses_user_idTousers     expenses[]          @relation("expenses_user_idTousers")
  project_members                      project_members[]
  projects                             projects[]
  purchase_orders                      purchase_orders[]
  sales_orders                         sales_orders[]
  task_attachments                     task_attachments[]
  task_comments                        task_comments[]
  tasks_tasks_assigned_toTousers       tasks[]             @relation("tasks_assigned_toTousers")
  tasks_tasks_created_byTousers        tasks[]             @relation("tasks_created_byTousers")
  timesheets                           timesheets[]
  roles                                roles               @relation(fields: [role_id], references: [id])
  vendor_bills                         vendor_bills[]
}

model vendor_bill_lines {
  id           Int          @id @default(autoincrement())
  bill_id      Int
  product_id   Int?
  description  String
  quantity     Decimal      @default(1) @db.Decimal(10, 2)
  unit_price   Decimal      @db.Decimal(10, 2)
  vendor_bills vendor_bills @relation(fields: [bill_id], references: [id], onDelete: Cascade)
  products     products?    @relation(fields: [product_id], references: [id], onDelete: Restrict)
}

model vendor_bills {
  id                Int                 @id @default(autoincrement())
  bill_number       String              @unique @db.VarChar(100)
  project_id        Int?
  purchase_order_id Int?
  vendor_id         Int
  bill_date         DateTime            @default(now()) @db.Date
  due_date          DateTime?           @db.Date
  status            vendor_bill_status  @default(draft)
  total_amount      Decimal             @default(0.00) @db.Decimal(12, 2)
  paid_amount       Decimal             @default(0.00) @db.Decimal(12, 2)
  notes             String?
  created_by        Int?
  created_at        DateTime            @default(now())
  updated_at        DateTime
  vendor_bill_lines vendor_bill_lines[]
  users             users?              @relation(fields: [created_by], references: [id])
  projects          projects?           @relation(fields: [project_id], references: [id])
  purchase_orders   purchase_orders?    @relation(fields: [purchase_order_id], references: [id])
  partners          partners            @relation(fields: [vendor_id], references: [id])

  @@index([project_id])
}

enum customer_invoice_status {
  draft
  sent
  paid
  cancelled
}

enum expense_status {
  submitted
  approved
  rejected
  reimbursed
}

enum partner_type {
  customer
  vendor
  both
}

enum project_status {
  planned
  in_progress
  completed
  on_hold
}

enum purchase_order_status {
  draft
  sent
  received
  cancelled
}

enum sales_order_status {
  draft
  confirmed
  done
  cancelled
}

enum task_priority {
  low
  medium
  high
  urgent
}

enum task_status {
  new
  in_progress
  blocked
  done
}

enum vendor_bill_status {
  draft
  posted
  paid
  cancelled
}
